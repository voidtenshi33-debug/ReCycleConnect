
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ReCycleConnect application.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The unique ID from Firebase Authentication."
        },
        "displayName": {
          "type": "string",
          "description": "The user's full name."
        },
        "photoURL": {
          "type": "string",
          "description": "The URL to the user's profile picture. This can be null or empty if they don't have one.",
          "format": "uri"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "createdAt": {
          "type": "string",
          "description": "The date the user joined.",
          "format": "date-time"
        },
        "lastKnownLocality": {
          "type": "string",
          "description": "The user's last selected locality for browsing items."
        },
        "averageRating": {
          "type": "number",
          "description": "The user's average rating from 1 to 5."
        },
        "ratingsCount": {
          "type": "number",
          "description": "The total number of ratings the user has received."
        }
      },
      "required": [
        "userId",
        "displayName",
        "email",
        "createdAt"
      ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item listed for exchange on ReCycleConnect.",
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "imageUrls": { "type": "array", "items": { "type": "string", "format": "uri" } },
        "category": { "type": "string" },
        "condition": { "type": "string", "enum": ["Working", "Needs Minor Repair", "For Spare Parts Only"] },
        "listingType": { "type": "string", "enum": ["Sell", "Donate"] },
        "price": { "type": "number" },
        "locality": { "type": "string", "description": "The locality slug e.g. 'kothrud'" },
        "createdAt": { "type": "string", "format": "date-time" },
        "ownerId": { "type": "string" },
        "ownerName": { "type": "string" },
        "ownerAvatarUrl": { "type": "string", "format": "uri" },
        "ownerRating": { "type": "number" },
        "status": { "type": "string", "enum": ["Available", "In Process", "Completed"] },
        "isFeatured": { "type": "boolean" }
      },
      "required": ["title", "description", "category", "condition", "listingType", "price", "locality", "createdAt", "ownerId", "ownerName", "status"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The document ID is the Firebase Authentication UID (`userId`).",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID from Firebase Authentication, used as the document ID."
            }
          ]
        }
      },
      {
        "path": "/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Stores all items listed on the platform.",
          "params": [
             {
              "name": "itemId",
              "description": "The unique ID for the item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the ReCycleConnect application's user profiles and related data, focusing on secure access and efficient queries. The primary collection, `users`, stores user profile information. To ensure authorization independence, the `users` collection uses path-based ownership, which simplifies security rules. This structure supports the required QAPs (Queries and Permissions) by segregating user data into a dedicated collection, and access control can be easily managed through Firebase Authentication and security rules. The `userId` is used as document ID. Additionally, the structure denormalizes the relationship between users and ratings, reported items, and wishlist items by storing references (IDs) within the user document itself, avoiding the need for complex joins or subcollection queries when fetching basic user profile information. The `items` collection stores all listed items, with a `locality` field to enable efficient location-based filtering."
  }
}
